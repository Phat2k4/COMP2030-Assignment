<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Service Request & Booking</title><link rel="stylesheet" href="../css/main.css"></head><body>
<header class="nav"><div class="row container"><a href="../index.html">FUSS</a></div></header>
<main class="container card">
  <h2>Request a session</h2>
  <div><label>Skill</label><select id="skill" class="input"></select></div>
  <div class="grid cols-2"><div><label>Date</label><input id="date" type="date" class="input"></div><div><label>Time</label><input id="time" type="time" class="input"></div></div>
  <div><label>Note</label><textarea id="note" class="input" rows="3"></textarea></div>
  <div class="row" style="margin-top:12px"><button class="btn primary" id="book">Book</button><small id="msg"></small></div>
</main>
<script type="module">
  import {api,currentUser,guardAuth} from '../js/app.js'; guardAuth();
  const u=currentUser(); const skills=api.skills();
  skill.innerHTML = skills.map(s=>`<option value="${s.id}">${s.title} (${s.price} credits)</option>`).join('');
  // preselect from query
  const q=new URLSearchParams(location.search).get('skill'); if(q) skill.value=q;
  book.onclick=()=>{
    if(!date.value||!time.value){ msg.textContent='Pick date & time.'; return; }
    api.addOrder({id:Date.now(), student:u.id, skill:+skill.value, when:`${date.value} ${time.value}`, note:note.value.trim(), price:skills.find(s=>s.id==skill.value).price, status:'Pending'});
    msg.textContent='Booked. See Transaction History.'; setTimeout(()=>location.href='transaction_history.html',700);
  };
</script>
</body></html>
