<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Messages</title><link rel="stylesheet" href="../css/main.css"></head><body>
<header class="nav"><div class="row container"><a href="../index.html">FUSS</a></div></header>
<main class="container grid cols-2">
  <div class="card">
    <h3>Conversation</h3>
    <div id="thread" class="list" style="max-height:380px;overflow:auto"></div>
    <div class="row"><input id="msg" class="input" placeholder="Type a messageâ€¦"><button class="btn primary" id="send">Send</button></div>
  </div>
  <div class="card">
    <h3>Contact</h3>
    <select id="peer" class="input"></select>
    <small>Demo uses localStorage</small>
  </div>
</main>
<script type="module">
  import {api,currentUser,guardAuth, $} from '../js/app.js'; guardAuth();
  const me=currentUser(); const users=JSON.parse(localStorage.getItem('users'));
  users.filter(u=>u.id!==me.id).forEach(u=> peer.innerHTML += `<option value="${u.id}">${u.name}</option>`);
  const render=()=>{ const t=api.thread(me.id, +peer.value); thread.innerHTML=t.map(m=>`<div class="card" style="background:${m.from===me.id?'#1b2850':''}">${m.text}<br><small>${new Date(m.ts).toLocaleString()}</small></div>`).join(''); thread.scrollTop=thread.scrollHeight; };
  peer.onchange=render; render();
  send.onclick=()=>{ if(!msg.value.trim())return; api.sendMessage(me.id,+peer.value,msg.value.trim()); msg.value=''; render(); };
</script>
</body></html>
